import random
import time
import math
import os
import logging
import numpy as np
from contextlib import contextmanager

from crypto.sife import SIFE
from crypto.sife_dynamic import SIFEDynamic

logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

tpa_config_file = 'config/sife_v785_b8.json'
client_config_file = 'config/sife_v785_b8_dlog.json'

@contextmanager
def timer(ctx_msg):
    """Helper for measuring runtime"""
    time0 = time.perf_counter()
    yield
    logger.info('[%s][elapsed time: %.2f s]' % (ctx_msg, time.perf_counter() - time0))


def test_generate_config_file():
    logger.info('testing generating config files')
    func_value_bound = 100000000
    # func_value_bound = 100
    secparam = 256
    # 2 parties settings
    sife = SIFE()
    eta = 785
    sife.generate_setup_config(tpa_config_file, secparam, eta)
    sife.generate_dlog_table_config(client_config_file, func_value_bound)


def test_sife_basic():
    logger.info("testing the correctness of basic sife.")

    eta = 5

    # prepare the test data
    max_test_value = 1000
    x = [random.randint(0, max_test_value) for i in range(eta)]
    y = [random.randint(0, max_test_value) for i in range(eta)]
    logger.debug("x: %s" % str(x))
    logger.debug("y: %s" % str(y))
    check_prod = sum(map(lambda i: x[i] * y[i], range(eta)))
    logger.debug('original dot product <x,y>: %d' % check_prod)

    sife = SIFE(eta=eta)
    sife.setup(secparam=256)
    pk = sife.generate_public_key()
    ct = sife.encrypt(pk, x)

    sk = sife.generate_private_key(y)
    max_interprod = max_test_value * max_test_value * eta
    with timer('total decryption time:') as t:
        dec_prod = sife.decrypt(pk, sk, y, ct, max_interprod)
        logger.debug('decrypted dot product <x,y>: %d' % dec_prod)


def test_sife_basic_with_config():
    logger.info("testing the correctness of sife using config file.")

    eta = 785

    # prepare the test data
    max_test_value = 10
    x = [random.randint(0, max_test_value) for i in range(eta)]
    y = [random.randint(0, max_test_value) for i in range(eta)]
    logger.debug("x: %s" % str(x))
    logger.debug("y: %s" % str(y))
    check_prod = sum(map(lambda i: x[i] * y[i], range(eta)))
    logger.debug('original dot product <x,y>: %d' % check_prod)

    sife = SIFE(tpa_config=tpa_config_file, client_config=client_config_file)

    pk = sife.generate_public_key()
    ct = sife.encrypt(pk, x)

    sk = sife.generate_private_key(y)
    max_interprod = max_test_value * max_test_value * eta
    with timer('total decryption time:') as t:
        dec_prod = sife.decrypt(pk, sk, y, ct, max_interprod)
        logger.debug('decrypted dot product <x,y>: %d' % dec_prod)


def test_sife_dynamic_with_config():
    logger.info("testing the correctness of sife using config file.")

    eta = 100

    # prepare the test data
    max_test_value = 10
    x = [random.randint(0, max_test_value) for i in range(eta)]
    y = [random.randint(0, max_test_value) for i in range(eta)]
    logger.debug("x: %s" % str(x))
    logger.debug("y: %s" % str(y))
    check_prod = sum(map(lambda i: x[i] * y[i], range(eta)))
    logger.debug('original dot product <x,y>: %d' % check_prod)

    sife = SIFEDynamic(tpa_config=tpa_config_file, client_config=client_config_file)

    pk = sife.generate_public_key()
    ct = sife.encrypt(pk, x)

    sk = sife.generate_private_key(y)
    max_interprod = max_test_value * max_test_value * eta
    with timer('total decryption time:') as t:
        dec_prod = sife.decrypt(pk, sk, y, ct, max_interprod)
        logger.debug('decrypted dot product <x,y>: %d' % dec_prod)


def test_sife_debug():
    x_ori = [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 19.0, 62.0, 232.0, 255.0, 229.0, 146.0, 22.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 26.0, 209.0, 253.0, 253.0, 253.0, 253.0, 253.0, 205.0, 25.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 71.0, 208.0, 253.0, 225.0, 55.0, 133.0, 165.0, 252.0, 253.0, 81.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 173.0, 253.0, 219.0, 0.0, 0.0, 0.0, 0.0, 206.0, 237.0, 33.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 127.0, 253.0, 226.0, 42.0, 0.0, 0.0, 0.0, 45.0, 241.0, 235.0, 26.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 39.0, 240.0, 251.0, 114.0, 0.0, 0.0, 0.0, 0.0, 111.0, 253.0, 236.0, 43.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 82.0, 253.0, 205.0, 0.0, 0.0, 0.0, 0.0, 35.0, 221.0, 253.0, 52.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 54.0, 245.0, 242.0, 112.0, 8.0, 0.0, 0.0, 167.0, 253.0, 220.0, 7.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 167.0, 253.0, 253.0, 234.0, 233.0, 233.0, 252.0, 224.0, 34.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.0, 158.0, 241.0, 253.0, 253.0, 253.0, 253.0, 194.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 41.0, 54.0, 97.0, 253.0, 253.0, 154.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.0, 203.0, 253.0, 242.0, 42.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 17.0, 253.0, 253.0, 160.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 59.0, 253.0, 253.0, 124.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 136.0, 253.0, 244.0, 18.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 60.0, 247.0, 253.0, 161.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 87.0, 253.0, 253.0, 72.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 147.0, 253.0, 246.0, 47.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 165.0, 253.0, 199.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 87.0, 253.0, 199.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
    y_ori = [-0.11616197852116428, -0.5846784606299213, -0.9708417742042865, -0.11292841185207325, 0.31064549953826326, -0.37539379495724035, -0.8807747773960226, -0.2522951121957162, -0.5903133214270462, -0.5833920112636857, 0.970614574787587, 0.5188817048302083, -0.09866861252666848, -0.8902137350994026, -0.9088438446773981, -0.9658579501631486, -0.9432025935849815, -0.07026603849346214, 0.17300408795125888, 0.19084397273467424, -0.5687706400075723, -0.12377358553828155, -0.9558126850093749, -0.014117245671397383, -0.4420219060742676, -0.5793287709944801, -0.4519302941695824, -0.44086538613814974, 0.9184657316497045, -0.19259242933388188, 0.6133038301767404, -0.6550123756048722, -0.32123370861740796, -0.830745902748629, 0.3994992646398903, 0.002502614910419698, -0.4722962230581902, -0.21773890536043639, 0.0022066174868853317, -0.10322776455195526, 0.03259983746572548, -0.8552762721000782, -0.4205619609915907, 0.5008694167186372, 0.41165251313818274, -0.618291192416575, -0.9601524623073141, -0.2192966994835439, 0.479761792502988, -0.29406224903229883, 0.41058092595249196, -0.35209882961299144, 0.326276993246867, -0.9813772465370949, -0.9444817082201034, -0.18468193106072373, 0.30884718619378737, 0.7443629242879422, 0.399844918970347, 0.730431801394158, -0.8614083896755662, -0.9863516062111919, 0.0013510523421189635, 0.6743326685331785, 0.5980895005378284, 0.3299173727700333, 0.2824416937559735, 0.3686882034763763, 0.6975943892795315, -0.9093875825147699, 0.16350377798367988, 0.48118664080514995, 0.21493730448051718, -0.05647334998592779, 0.08770326625620095, -0.8637270021611376, -0.4204196895464174, 0.5530845857070261, 0.3196259887043882, -0.6775605998405161, 0.3207234623379869, -0.6171323073611985, 0.912615009837229, -0.48392558684354814, 0.5464168699796284, -0.7093106646433514, -0.8946323818449664, 0.6437596311554656, -0.7918010352675082, 0.318038400422221, 0.5698116297621036, 0.945962285788009, -0.7018250394539136, -0.44928451200141195, -0.5462531096127852, -0.9764071817416342, 0.2657892562932289, 0.3883371168721135, -0.3073364704711259, 0.995147627213383, -0.9528429948913988, -0.45184509782214666, -0.15576525405924802, 0.36813063098833676, 0.833190375517336, -0.5765512729825182, 0.35136998467338065, 0.8079845968248505, 0.0007056904401538944, -0.07928459379652009, 0.621752732657793, -0.19624923277655104, 0.3983756404159804, 0.3146172549692694, -0.8617487377549522, 0.925834986155091, 0.16569674959801928, 0.45468171834992344, 0.5819178538376812, 0.14844211130020546, 0.8107412378914249, 0.910901720211561, 0.9304866301409584, -0.7306691701054644, -0.5337057140573309, 0.8082914554122729, 0.35988860263770284, 0.3078095119585038, 0.9915685759126582, -0.22700069161284042, -0.14201662722927622, -0.5023932439848089, -0.582150491352663, -0.7090436230884158, 0.967032673811435, 0.2164435737805317, 0.4044147686750872, 0.20722295936422896, 0.35342341709894787, 0.9755362499174249, 0.10309946992366914, -0.19214898039249406, 0.06490326874651986, 0.15191376262932166, -0.0307270506275652, -0.11248725482115662, 0.7366865628800314, 0.6667086403270839, -0.35734552529309394, -0.9903855376057031, 0.2869209366181471, -0.37060385313884847, 0.6627111690812901, 0.17753361322890582, -0.5663458253469296, -0.24963678689825164, -0.008229944429302138, -0.7806120856678143, -0.3571963565000815, -0.09172390726696666, 0.12437661586485116, 0.22672557219425205, 0.7173826254165703, -0.556695892019132, 0.28764931784064873, -0.544232276203205, 0.019213851881727084, -0.437887580609734, 0.6352694388276567, 0.4262421948862982, 0.9457907954469689, 0.5063287205327021, -0.8652362376472078, -0.2753782083064007, -0.8672275831938236, -0.40005343997656007, 0.7148605415082914, 0.0009746487955182292, -0.6359960806143616, 0.08566384433494512, 0.4273789613432457, 0.2402465192761729, 0.07588634753278822, 0.3785528036627024, 0.1422487173012339, -0.716388472212121, 0.43098543630407704, -0.03148573899411966, 0.740741738802257, -0.37331326551312216, -0.7658870203635437, 0.9938256371059628, -0.8608335644898208, -0.36446887368749015, -0.5936545787833589, -0.15323386109457093, 0.6215987391939772, 0.5383680733804235, -0.27268890946116087, 0.08493114868243667, -0.8419924575911126, -0.5225606949163586, -0.6517838364412738, 0.298567916191423, -0.6445399617299679, 0.15325789368687226, 0.8016181643833129, 0.039349324383604056, 0.1327585467098995, -0.8645858697179256, -0.9257108780930883, -0.26753953489245275, 0.5912916296401036, 0.4428926335352137, -0.21571924068339476, 0.6033409784657384, 0.13137426515287376, 0.6080856807785255, 0.23863171215909218, -0.7298320157388065, 0.8958243596096123, -0.14776684490027736, 0.7653665319495797, 0.8197473410576617, -0.42821435928459195, 0.5537303637639219, 0.7756217559322118, 0.6208563720073059, 0.49581355489319323, 0.5770309036912551, -0.6389192753628361, -0.3115384583766261, 0.9107021335278449, 0.676484326219132, -0.8725268090198872, 0.7659762004096236, 0.7794867125571545, 0.815135908416748, -0.9415286519806201, 0.03699583646271454, -0.5073890535692431, 0.8108152896792877, -0.3298135143936758, -0.455480146343219, 0.03247288086066091, 0.7421935521659131, -0.26534097951029123, 0.9147032633315979, 0.4136020596913532, 0.826067732880774, 0.32923817106427333, 0.1409003039264991, 0.7823976842777218, 0.6006960895362248, -0.6008338950307484, -0.10891090845832463, -0.3224443002810409, -0.7531565569478946, 0.42438125480307454, -0.6596850318498082, 0.5688039371786646, -0.7318918943369221, 0.8817957022723357, -0.2968567623425371, 0.09788227212104905, -0.9639694858059795, 0.4785247330422644, 0.6836195399811049, -0.3902297495108329, 0.86174181405327, -0.7937646392510498, -0.14300513689019567, 0.5093297002069066, 0.540489486342318, 0.13618663607749282, 0.6403972349090317, -0.08266985197029308, -0.33458563883206205, 0.3169279528987521, -0.9632003311355397, -0.8934855808458448, -0.5599556828764827, 0.5334785601705898, -0.5497299113684826, -0.7312449126622345, 0.701486317928089, 0.7100280261267033, -0.5444588867083147, 0.18821153591193185, 0.9926202197152434, 0.33705992399709594, 0.5164931505389596, 0.15572568671494502, 0.5566671873191984, -0.7878447669343356, -0.5642160811290353, -0.786592253683996, -0.1426584976258074, -0.43092235472675267, 0.47788634635905836, -0.20317885852532536, -0.815142479515703, 0.6294423700796024, -0.5324797516718156, -0.6368104353272954, -0.3898971836463603, -0.796979092177857, 0.35290205060564017, 0.3516190053075461, -0.07338065323379128, 0.3951422106107563, -0.39735669636715487, 0.592836717604408, 0.19648354081159924, 0.7144759586874563, 0.7558318153778953, 0.1143077575130258, -0.12438680393123103, -0.4895052955076531, -0.0409983483558467, 0.856679642728094, -0.7477349172739804, 0.01955628882512772, 0.236386491007063, -0.9781551911271942, 0.7709037322125887, 0.9848127541464378, 0.26876014647087976, 0.6801035854756352, 0.7328833019422751, -0.3457638352936998, 0.09498845436872605, -0.0070780021245719915, -0.08083641946240938, 0.2060526762084922, 0.7630035273133788, 0.4221564190228557, 0.7473144036302934, 0.7545448349117898, 0.9583271064165724, -0.8606607976641214, 0.7986865231727307, -0.2418330497135961, 0.653502803572495, 0.12862016175149749, -0.7725965606531033, 0.7819104587041403, 0.007517359922476485, -0.636827304253518, 0.8912849039170876, 0.17307223148140927, 0.09868349206220906, -0.35398376507516827, 0.3500574961132481, 0.35241181720938686, 0.5227449636535879, -0.42694158744266697, -0.2783810339251913, 0.18796529444618248, -0.6185616862410388, 0.7080191194878294, 0.07808118214793391, 0.029310792937508268, -0.8447020285099474, 0.21991170933891246, 0.12293449737606355, 0.374965573689249, -0.15257997052681516, 0.18647506173784256, 0.9380827834281462, -0.0860090303262031, 0.020253114935365746, 0.3320705173703995, -0.3645011077428797, -0.7328259099625771, 0.9021306145216113, 0.42609434848342853, -0.4795446374797394, 0.3878124351207033, 0.46870093901149423, 0.23629695189638555, -0.8117785020429438, 0.43837946187517507, 0.0814865548535435, -0.3439740093970278, 0.40062389957425504, -0.19000205507003187, 0.84819957490103, 0.15877393970895026, -0.18255694741986184, -0.7302758713460393, -0.7814317003299291, 0.5614630525185298, -0.716912924995101, -0.21751689537345253, -0.8235139609527755, 0.8645750316517093, 0.44232088502511635, 0.9555736135033686, -0.1417660064217785, 0.7384126361901395, -0.7261240136941842, -0.42546876586896554, 0.8022971477662528, -0.3900999338243687, -0.8889282959179976, -0.34528460742022005, 0.07390762543354779, -0.8871443654129834, -0.4273387099728281, 0.02783137155525872, 0.48267747050225496, -0.9731748643071378, 0.2932400427013466, -0.19071151166253397, -0.7949810334055518, 0.8701090181626869, -0.9020585219302986, -0.10819073586810646, -0.7660862567839366, -0.8069849866652727, 0.9192853535457945, 0.6775200993178323, -0.5913762800399891, -0.0019709356301771397, 0.6351922013021987, -0.11780958878581926, -0.024125283112430562, -0.5858474121647037, -0.7915213691877936, 0.5002324985590005, 0.7674068279791988, -0.29509496148497605, -0.18868405211045225, 0.048196013099095936, 0.8075428161634213, -0.5089069600054172, -0.5027655073915958, 0.1849916552573836, 0.7243833896727279, -0.9533012193657422, -0.9894098121473982, 0.220714468103685, 0.5271953719436977, 0.7772024287742241, -0.4373061922587911, -0.7825727646227387, -0.7282578938713673, -0.08288454077907681, 0.8481434760644366, 0.8322500933732555, 0.022351202148706895, 0.701887583558866, -0.5451477707344126, -0.13551835234994192, -0.879166736034994, -0.43595828800671854, -0.3128775955265479, -0.8482921738454627, 0.8687699252554584, -0.6772352598446982, 0.35772261275513073, -0.9580218968528633, -0.27695329423986026, 0.8357837625633662, -0.3711563133810789, -0.00985775308648762, 0.9832161610578825, -0.7172287951347953, -0.45139648730445847, -0.8589150154774836, 0.9166926057259122, -0.13691807995649086, 0.6176570013108804, -0.031402727023015053, -0.21563478490710408, -0.28240230056772675, 0.9896961189430671, 0.3412810596677134, -0.6006619987066015, -0.7320194863142004, -0.10229517359416107, 0.7927243638094397, -0.24044672630574238, -0.7227960937655029, -0.475190956203803, 0.39317025377109416, 0.9838428307135461, 0.4405261890491665, -0.9435297829909408, 0.8766492572210443, -0.8471957096115565, -0.4717125782873437, 0.3419541484705595, -0.7662229293833198, -0.22436795447575086, -0.5114141359691238, -0.30281940458486223, 0.44304321133234326, 0.024405436013871906, -0.6281263269125263, -0.4698990843788533, -0.015989957213425, 0.24253824090412524, 0.8622311240488028, 0.8181771634876658, -0.5405421691831824, -0.8256873011127173, -0.9328092535572519, -0.9592552170408786, -0.5464145944123313, -0.28101382444270584, -0.7653486272349257, -0.821203707196231, -0.18062659280664306, -0.7300701951916297, 0.5907221448654922, -0.8805538894055265, -0.25061118278918215, -0.7507537395438526, 0.7100195912838689, 0.021900975755701824, -0.5721587464919606, -0.9935335014712963, -0.2779715663313922, 0.27810076135178075, -0.8139097402505451, -0.39844003731395294, -0.15231431905963744, -0.7610641269514151, 0.45588603313459997, 0.29316434506011424, -0.18686176253367281, 0.5417730732760451, 0.4301083773814327, 0.11683044027320166, -0.4783067766959055, 0.4117389458973395, -0.4633455975136933, -0.5839201185927116, -0.8325623460337923, -0.9735991155643053, -0.49016324730998395, 0.8452504637192528, -0.5211273587555765, 0.8348606465417387, 0.33036713225126335, 0.0949611520044864, -0.2923296455364415, 0.2770827063795629, -0.9430186368987223, 0.5084910380058669, -0.6122626502205839, 0.13755167551161374, -0.17322521896184861, -0.8916874383539737, -0.4093880907334382, 0.07835622466283065, 0.582279597435184, -0.6765372502035945, -0.6090928708196952, -0.9865186453140367, -0.1083173700792297, 0.24432365073676166, 0.05535512937147269, 0.9091798285321571, 0.549212988103204, -0.5272204331200687, 0.750062262367831, -0.03137689063201221, -0.8787832128878312, -0.4632599908661448, 0.4056266857729116, 0.7583264552699556, 0.9558038832610096, -0.8648251786611518, -0.32121785053178153, 0.4958522449802867, -0.21250839639192254, 0.8237341719683835, 0.11051252579895476, 0.05236179039308375, -0.8142277575619594, -0.7437937795492913, -0.16498404632333852, 0.1259624772178145, -0.6734030377799018, -0.011761208878242613, -0.7387055972663934, -0.28677662518196545, 0.8656764147127598, 0.8309126071285484, 0.31809938338057364, 0.42533508058799696, 0.23353668920560366, -0.10514812428687326, -0.30416813854282143, -0.5494133109117654, 0.32682237678593884, 0.032293662422684166, 0.5866206291631653, 0.20549758701943888, 0.8561175884048116, -0.5099697425068961, 0.611125366608835, 0.14183677988270027, 0.4709996398297782, -0.5362231732912595, 0.8147557666051357, -0.942784006196346, -0.19106993610753564, -0.19900482527011798, -0.4582267775601485, 0.32259130288725824, -0.9203251466832956, 0.3230957918947732, -0.6883447423312121, 0.2801437876878856, 0.7481139244413426, -0.5379479170820147, -0.9244941316037159, 0.5340423533284344, -0.46742312066410174, 0.37094285749005373, 0.8093550181256999, 0.9345910099839156, 0.31976450526177036, 0.022927195043096482, 0.4931222519793428, -0.8584945176558973, -0.036751260382177575, 0.20512132807808392, -0.06467209702636612, -0.8284768400773668, 0.02152196236978199, -0.7779652875421523, 0.590943696694519, -0.10404757124641772, 0.353595237760844, 0.733900192301391, 0.9285313708937395, -0.2159230826618892, 0.8770677460858023, 0.09423370414431309, -0.10923680460025698, -0.2292734002311414, 0.453476087947297, 0.8801697708265197, 0.6973496826408925, 0.2681628053446108, 0.36197752908829317, 0.1443664879514852, -0.47802623226625096, -0.6208503915544852, 0.3649865946247204, -0.5798920183843179, -0.5337940195573947, -0.5581863054426217, -0.5545006149241667, -0.5197546902187502, -0.07685182042432648, -0.33844147951516, -0.6950533966244858, 0.7137868168150263, -0.879519645413041, -0.734970312892048, -0.24381440907065977, -0.4015068223058702, -0.7510550248688008, -0.6373329738103588, 0.15435575062383045, -0.5598584405331812, 0.8952929596064945, 0.9513894324299546, 0.3315446665064512, -0.5047045231780378, -0.7425744037082112, -0.46121055633457786, -0.5895361701392006, -0.24325987604353028, -0.8819113914274714, 0.8622475624408918, -0.5689281895784677, -0.39199477079412737, 0.36848023420413445, -0.026512560253199258, -0.3057221192689972, 0.998967651667187, 0.7144612600331461, -0.619093312424271, 0.758183225362957, 0.9509455804362239, 0.6068681201213408, -0.905699232591024, 0.7346087639377861, -0.5637270862743866, -0.8630699727197522, -0.8286444288643888, 0.6017138201310497, -0.7921116254396998, 0.2997945732391034, 0.4275408806266783, 0.3379080951118918, 0.7032963673021668, 0.13382639026942944, 0.3671415839039571, 0.02994899898765402, 0.7597938712907448, -0.26325492679819695, 0.33812081177984465, 0.41771025740902856, -0.7928320977673673, 0.5910301197361483, -0.1726338639680205, 0.15366421161884714, -0.3290043488610557, 0.3427779311954997, 0.4696992152112962, 0.5631842268295892, -0.49102171993886023, -0.3276791238117627, 0.3469803346988387, 0.9274122631717827, 0.5143364874043077, 0.6809914380725286, -0.7800174001605631, -0.9861695241670989, 0.39320646203216625, 0.1181339464963218, 0.026324889429313547, -0.14490210783581214, -0.40666211466461966, 0.39706581657250317, 0.5820872422548342, 0.11626639952487006, -0.17961617619416814, 0.6595241203424727, -0.1194896028342789, 0.11702349531895084, -0.6463259077173218, 0.2915417597372112, -0.8607749512513341, -0.6969509388924442, 0.8467813757252964, -0.5393735485988849, 0.9882127837921975, 0.2971626187419967, 0.7904541854093017, -0.18625373426180025, -0.6434959273496401, -0.6465168669232195, 0.9339569081970827, 0.8030594976675713, -0.19003787718789744, 0.21902398969481607, 0.4420951868076577, 0.5724219792136, -0.7091630621247242, 0.7992140178220695, 0.576202358985251, -0.0007051254914001159, -0.6834843492385796, -0.08803106637363278, 0.7765036790279682, 0.8749822376054348, -0.9563388770596997, 0.8228848076221258, -0.8664763593618261, -0.4943515367968785, -0.4872673430662504, -0.9843470246103205, -0.727935038810291, -0.8720605088547073, 0.510203867584178, 0.6805692332587354, -0.6235718959867678, -0.8798334765132858, 0.040554079877801685, 0.20385325411206945, 0.4234245210253029, 0.760610120873531, -0.21843373309184555, -0.8989732815554532, 0.3395359310165311, 0.00356473032560789]
    x = (np.array(x_ori)).astype(int).flatten().tolist()
    y = (np.array(y_ori) * pow(10, 3)).astype(int).flatten().tolist()
    eta = 785
    check_prod = sum(map(lambda i: x[i] * y[i], range(eta)))
    logger.debug('original dot product <x,y>: %d' % check_prod)

    sife = SIFE(tpa_config=tpa_config_file, client_config=client_config_file)

    pk = sife.generate_public_key()
    ct = sife.encrypt(pk, x)
    sk = sife.generate_private_key(y)
    max_inner_prod = 100000000
    with timer('total decryption time:') as t:
        dec_prod = sife.decrypt(pk, sk, y, ct, max_inner_prod)
        logger.debug('decrypted dot product <x,y>: %d' % dec_prod)